{% extends "::base.html.twig" %}

{% block title %}AppBundle:Game:play{% endblock %}
{% block head %}
    <link rel="stylesheet" type="text/css" href="../../css/loading-bar.css"/>
    <script type="text/javascript" src="../../javascript/loading-bar.js"></script>
{% endblock %}

    {% block body %}

    <style type="text/css">
        #white
        {
            background-color: white;
            height: 60px;
            width: 60px;
        }
        #brown
        {
            background-color: #763709;
            height: 60px;
            width: 60px;
        }
        #tablo{
            margin-left:auto;
            margin-right:auto;
            border:1px solid #000000;
            width: 20cm;
            overflow: hidden;
            table-layout:fixed;

        }
        #tablo tr{
            border:1px solid #000000;
            height: 2cm;
            width: 2cm;

        }
        #tablo td{
            border:1px solid #000000;
            text-align:center;
            word-wrap:break-word;
        }

    </style>
    <script>
        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("pion", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("pion");
            ev.target.appendChild(document.getElementById(data));
            document.getElementById('affichage').innerHTML = "from" + data + "to" + ev.target(id);
            window.location.href = 'http://www.google.fr/'
        }
    </script>

    {% if is_granted('ROLE_USER') %}
        {% if game.state == 0 %}

            <h4> En attente d'un joueur pour la partie : {{ game.name }}</h4>
            <blockquote> Créee par : {{ creator }}</blockquote>

            <a href="{{ path('app_game_remove', {id: game.id}) }}" >
                <button class="btn waves-effect waves_light  red darken-1">
                    Annuler <i class="material-icons right">clear</i>
                </button>
            </a>


        {% else %}

            <h4> Lancement de la partie : {{ game.name }}</h4>
            <blockquote> Créee par : {{ creator }}</blockquote>

                   <div id="affichage"></div>
            <table id="tablo">
                {% set x = 0 %}
                {% set y = 0 %}
                {% for lines in plateau %}
                    <tr>
                        {% for case in  lines %}
                            {% if case == 1 %}
                                <td id="c{{ y}}{{ x }}" class="brown" ondrop="drop(event)" ondragover="allowDrop(event)">  <img id="p{{ y}}{{ x }}" src="https://image.ibb.co/g8APay/cercle_plein.png" draggable="true" ondragstart="drag(event)" height="40px" width="40px"></td>
                            {% elseif case == 2 %}
                                <td id="c{{ y}}{{ x }}" class="brown" ondrop="drop(event)" ondragover="allowDrop(event)">  <img id="p{{ y }}{{ x }}" src="https://image.ibb.co/dcuT2d/round.png" draggable="true" ondragstart="drag(event)" height="40px" width="40px"></td>
                            {% elseif case == 0 %}
                                <td id="c{{ y}}{{ x }}" class="brown" ondrop="drop(event)" ondragover="allowDrop(event)"></td>
                            {% else %}
                                <td id="c{{ y}}{{ x }}" class="white"></td>
                            {% endif %}
                            {% set x=x+1 %}
                        {% endfor %}
                        {% set y = y+1 %}
                    </tr>
                {% endfor %}
            </table>
            <a href="{{ path('app_game_abandon', {id: game.id}) }}" >
                <button class="btn waves-effect waves_light red darken-1"><i class="material-icons right">clear</i>
                    Abandonner
                </button>
            </a>
        {% endif %}

    {% endif %}

{% endblock %}